---
title: ユニバーサル Windows プラットフォーム (UWP) アプリにおけるガイド付き最適化のプロファイル (PGO) の実行
description: ユニバーサル Windows プラットフォーム (UWP) アプリに対してガイド付き最適化のプロファイル (PGO) を適用するための手順を説明するガイドです。
ms.date: 02/08/2017
ms.localizationpriority: medium
ms.topic: article
ms.openlocfilehash: a606d87b309b130cd9bb0cdc90a2a8b3a3bcc717
ms.sourcegitcommit: a30808f38583f7c88fb5f54cd7b7e0b604db9ba6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/06/2020
ms.locfileid: "91762855"
---
# <a name="running-profile-guided-optimization-on-universal-windows-platform-apps"></a>ユニバーサル Windows プラットフォーム アプリにおけるガイド付き最適化のプロファイルの実行 
 
このトピックでは、ユニバーサル Windows プラットフォーム (UWP) アプリに対してガイド付き最適化のプロファイル (PGO) を適用するための手順を説明します。 従来の win32 アプリケーションで利用可能な手順の一部は UWP アプリでは利用できません。そのため、UWP 開発者にとって最適化がより簡単かつ利用しやすくなるよう、PGO を組み込むために必要な方法を説明することを目標としています。

Visual Studio 2015 Update 3 を使用して既定の DirectX 11 アプリ (UWP) テンプレートに PGO を適用する方法の基本的なチュートリアルを次に示します。
 
このガイド全体にわたって、スクリーンショットは次の新しいプロジェクトに基づきます。![[新しいプロジェクト] ダイアログ ボックスで [インストール済み] > [テンプレート] > [Visual C++] が選択され、[DirectX 11 アプリ] オプションが強調表示されているスクリーンショット。](images/pgo-001.png)

PGO を DirectX 11 アプリ テンプレートに適用するには、次の手順に従います。

1. ソリューションの構成を **[Release]** に設定するか、リリース目的の最適化されたコードを生成するソリューションの構成を選択します。 論理的には、デバッグ ビルドに対して PGO を実行することもできますが、他の最適化されないビルドを最適化するために PGO を使用するのは有効ではありません。 
 
 ![[App1] ウィンドウ](images/pgo-002.png)
 
2. プロジェクトのプロパティ ( **[プロパティ]**  >  **[C/C++]**  >  **[最適化]** ) で、 **[プログラム全体の最適化]** に /GL フラグを設定してビルドしていることを確認します (これは構成によって既に設定されている可能性があります)。

 ![プログラム全体の最適化](images/pgo-003.png)

3. リンカーのプロパティ ( **[プロパティ]**  >  **[リンカー]**  >  **[最適化]** ) に移動し、 **[リンク時のコード生成]** を **[ガイド付き最適化のプロファイル - インストルメント (LTCG:PGInstrument)]** に設定します。
 
 ![リンク時のコード生成](images/pgo-004.png)

4. **[ソリューションのビルド]** をクリックした後、 **[ソリューションの配置]** をクリックします。 

 ![[ビルド] ドロップダウン リストで、[ソリューションのビルド] および [ソリューションの配置] オプションが赤色の矢印で示されているスクリーンショット。](images/pgo-005.png)
 
 ビルドの出力場所を見て、.pgd ファイルが生成されていることを確認することで、すべてが適切に動作していることを再確認できます。 この例の場合、ビルドの出力と一緒に次のファイルが生成されていることを意味しました。
 
 `C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1.pgd`

 既定では、.pgd ファイルは実行可能ファイルと同じ名前です。 **[ガイド付きデータベースのプロファイル]** リンカー オプションを変更することで、生成される .pgd ファイルの名前を変更することもできます。 
 
5. Visual Studio VC バイナリ ディレクトリに移動します (既定では `C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\bin` のようになります)。 x86 実行可能ファイルの場合、`pgort140.dll` をコピーします。x64 実行可能ファイルの場合、`amd64\pgort140.dll` から x64 バージョンをコピーします。 `pgort140.dll` の適切なバージョンを、配置したパッケージのルートに貼りつけます。 このサンプルのパスは次のとおりです。

 `C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\AppX\`

 UWP アプリでは、パッケージ内に存在するライブラリしか読み込むことができないため、この手順は必須です。

 ![AppX フォルダーの内容を表示しているエクスプローラー ウィンドウのスクリーンショット。](images/pgo-006.png)
 
6. [スタート] メニューから、または Visual Studio の **[デバッグ]** メニューから **[デバッグなしで開始]** オプションを使用してアプリを実行します。 

 ![[デバッグ] ドロップダウン リストで [デバッグなしで開始] オプションが強調表示されている状態を示すスクリーンショット。](images/pgo-007.png)
 
7. 現在実行しているビルドがインストルメント化され、PGO データが生成されます。 この時点で、最適化する予定の最も一般的なシナリオを通じてアプリケーションを実行する必要があります。 目的のシナリオすべてでプログラムの実行を終えたら、pgosweep.exe ツールを探します。これは、適切なバージョンの `pgort140.dll` と同じフォルダーに含まれます。 または、Visual Studio (x86/x64) Native Tools コマンド プロンプトに、既にそのパスの適切なバージョンが設定されています。 PGOデータを収集するには、アプリケーションの実行中に次のコマンドを実行し、プロファイリング データを含む .pgc ファイルを生成します。
 
  `pgosweep.exe <executable name> <output file>` 
 
  PGO データの収集方法を制御する他のオプションの引数を確認するために、pgosweep.exe のヘルプ (`pgosweep.exe /help`) を表示することもできます。
 
  .pgd が含まれるビルド場所に .pgc ファイルを出力し、ファイルに `<PGDName>!<RunIdentifier>.pgc` という名前を付けることもお勧めします。 この例では、次のようになります。
 
  ```
  pgosweep.exe App1.exe "C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1!1.pgc"
  ```
 
  さらに収集する場合は、`App1!CoreScenario.pgc`、`App1!UseCase5.pgc` などのようにもできます。.pgc の名前をこのように付け、ビルドの出力場所が .pgd の隣である場合、手順 9 でリンクするときに自動的にマージされます。
 
8. 省略可能:既定では、手順 7 で指定したように名前を付け、.pgd の隣に配置した .pgc ファイルはすべて、リンクするときにマージされ、平等に重み付けされますが、特定の実行に重みを付ける方法をより詳細に制御することもできます。 これを行うには、**pgomgr.exe** ツールを使用します。このツールも、最初に `pgort140.dll` のコピーを見つけたフォルダーと同じフォルダーにあります。 たとえば、`CoreScenario` の実行を他の実行の優先度の 3 倍でマージするには、次のコマンドを使用します。
 
 ```
 pgomgr.exe -merge:3 "C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1!CoreScenario.pgc" "C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1.pgd"
 ```
 
9. 1 つ以上の .pgc ファイルを生成し、それを .pgd の隣に配置するか手動でマージ (手順 8) したら、リンカーを使用して最終的な最適化されたビルドを作成できます。 リンカーのプロパティ ( **[プロパティ]**  >  **[リンカー]**  >  **[最適化]** ) に戻り、 **[リンク時のコード生成]** を **[ガイド付き最適化のプロファイル - 最適化 (LTCG:PGOptimize)]** に設定したら、 **[ガイド付きデータベースのプロファイル]** が使用予定の .pgd をポイントしていることを確認します (これを変更していない場合、すべてを順序どおりにする必要があります)。

 ![[App 1 プロパティ ページ] ダイアログ ボックスで、[構成プロパティ] > [リンカー] > [最適化] が選択され、[リンク時のコード生成] オプションと [ガイド付き最適化のプロファイル - 最適化 (/LTCG:PGOptimize)] オプションが強調表示されているスクリーンショット。](images/pgo-009.png)
 
10. プロジェクトがビルドされたら、リンカーによって pgomgr.exe が呼び出され、すべての `<PGDName>!*.pgc` ファイルが既定の重み 1 が設定された .pgd にマージされます。作成されるアプリケーションは、プロファイリング データに基づいて最適化されます。

## <a name="see-also"></a>関連項目
- [パフォーマンス](performance-and-xaml-ui.md)

 

