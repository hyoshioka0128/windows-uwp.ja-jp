---
ms.assetid: 9322B3A3-8F06-4329-AFCB-BE0C260C332C
description: この記事では、さまざまな展開およびデバッグのターゲットを指定する手順について説明します。
title: ユニバーサル Windows プラットフォーム (UWP) アプリの展開とデバッグ
ms.date: 04/08/2019
ms.topic: article
keywords: Windows 10, UWP, デバッグ, テスト, パフォーマンス
ms.localizationpriority: medium
ms.openlocfilehash: 0f1ff6a98182f4832a2a1b82bf8ceca4aa176c36
ms.sourcegitcommit: 7b2febddb3e8a17c9ab158abcdd2a59ce126661c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/31/2020
ms.locfileid: "89157266"
---
# <a name="deploying-and-debugging-uwp-apps"></a>UWP アプリの展開とデバッグ

この記事では、さまざまな展開およびデバッグのターゲットを指定する手順について説明します。

Microsoft Visual Studio では、さまざまな Windows 10 デバイスにユニバーサル Windows プラットフォーム (UWP) アプリを展開してデバッグできます。 Visual Studio は、ターゲット デバイスにアプリを展開して登録するプロセスを処理します。

## <a name="picking-a-deployment-target"></a>展開ターゲットの選択

ターゲットを選択するには、 **[デバッグの開始]** ボタンの横にあるデバッグ ターゲットのドロップダウンに移動し、アプリの展開先のターゲットを選択します。 ターゲットを選択した後で、そのターゲットに展開してデバッグする場合は **[デバッグの開始 (F5)]** を選択し、単にそのターゲットに展開する場合は **Ctrl + F5** キーを押します。

![デバイスのターゲットの一覧のデバッグ](images/debug-device-target-list.png)

- **[シミュレーター]** は、現在の開発コンピューター上のシミュレートされた環境にアプリを展開します。 このオプションは、アプリの **[ターゲット プラットフォームの最小バージョン]** がご使用の開発マシンのオペレーティング システム以下である場合にのみ使用できます。
- **[ローカル コンピューター]** は、現在の開発コンピューターにアプリを展開します。 このオプションは、アプリの **[ターゲット プラットフォームの最小バージョン]** がご使用の開発マシンのオペレーティング システム以下である場合にのみ使用できます。
- **[リモート コンピューター]** では、アプリを展開するリモート ターゲットを指定できます。 リモート コンピューターへの展開について詳しくは、「[リモート デバイスの指定](#specifying-a-remote-device)」をご覧ください。
- **[デバイス]** は、USB 接続のデバイスにアプリを展開します。 デバイスが開発者によりロック解除され、画面がロック解除されている必要があります。
- **[エミュレーター]** ターゲットが起動し、名前で指定された構成のエミュレーターにアプリが展開されます。 エミュレーターは、Windows 8.1 以降を実行している Hyper-V 対応マシンでのみ使用できます。

## <a name="debugging-deployed-apps"></a>展開されているアプリのデバッグ

Visual Studio では、 **[デバッグ]** 、 **[プロセスにアタッチ]** の順に選ぶことによって、実行中の任意の UWP アプリ プロセスにアタッチすることもできます。 実行中のプロセスにアタッチする場合、元の Visual Studio プロジェクトは必要ありませんが、プロセスの[シンボル](#symbols)を読み込むことは、元のコードを持たないプロセスのデバッグ時に非常に役立ちます。  

さらに、 **[デバッグ]** 、 **[その他]** 、 **[インストールされているアプリケーション パッケージのデバッグ]** を選択することによって、インストール済みのアプリ パッケージにアタッチしてデバッグすることができます。

![[インストールされているアプリケーション パッケージのデバッグ] ダイアログ ボックス](images/gs-debug-uwp-apps-002.png)

**[起動はしないが、開始時にコードをデバッグする]** を選択すると、Visual Studio デバッガーは、UWP アプリが独自のタイミングで起動したときに、UWP アプリにアタッチします。 これは、カスタム パラメーターを使ったプロトコルのアクティブ化など、[さまざまな起動方法](../xbox-apps/automate-launching-uwp-apps.md)からの制御パスをデバッグするのに効果的な方法です。  

UWP アプリは、Windows 8.1 以降で開発してコンパイルすることができますが、実行するには Windows 10 が必要です。 Windows 8.1 PC で UWP アプリを開発している場合、別の Windows 10 デバイスで実行されている UWP アプリをリモートでデバッグできます。ただし、ホストとターゲットの両方のコンピューターが同じ LAN に接続されている必要があります。 これを行うには、両方のコンピューターに [Remote Tools for Visual Studio](https://visualstudio.microsoft.com/downloads/) をダウンロードしてインストールします。 インストールするバージョンはインストール済みの Visual Studio の既存のバージョンと一致している必要があり、選択するアーキテクチャ (x86、x64) もターゲット アプリのアーキテクチャと一致している必要があります。

## <a name="package-layout"></a>パッケージのレイアウト

Visual Studio 2015 Update 3 で、開発者が UWP アプリのレイアウト パスを指定するためのオプションを追加しました。 これにより、アプリをビルドするときの、パッケージのレイアウトのディスク上でのコピー先を指定します。 既定では、このプロパティは、プロジェクトのルート ディレクトリに相対的に設定されます。 このプロパティを変更しない場合には、動作は Visual Studio の以前のバージョンと同じです。

このプロパティは、プロジェクトの **デバッグ** プロパティで変更できます。

アプリのパッケージを作成するときに、パッケージにすべてのレイアウト ファイルを含める場合には、プロジェクト プロパティ `<IncludeLayoutFilesInPackage>true</IncludeLayoutFilesInPackage>` を追加する必要があります

このプロパティを追加するには

1. プロジェクトを右クリックし、 **[プロジェクトのアンロード]** をクリックします。
2. プロジェクトを右クリックし、 **[[プロジェクト名].xxproj の編集]** を選択します (.xxproj は、プロジェクトの言語に応じて変わります)。
3. プロパティを追加し、プロジェクトを再度読み込みます。

## <a name="specifying-a-remote-device"></a>リモート デバイスの指定

### <a name="c-and-microsoft-visual-basic"></a>C# および Microsoft Visual Basic

C# または Microsoft Visual Basic のアプリのリモート コンピューターを指定するには、デバッグ ターゲットのドロップダウンで **[リモート コンピューター]** を選択します。 **[リモート接続]** ダイアログが表示され、IP アドレスを指定するか、または検出されたデバイスを選択できます。 既定では、 **[ユニバーサル]** 認証モードが選択されます。 使用する認証モードを決定するには、「[認証モード](#authentication-modes)」をご覧ください。

![リモート接続ダイアログ ボックス](images/debug-remote-connections.png)

このダイアログに戻るには、プロジェクト プロパティを開き、 **[デバッグ]** タブに移動します。そこから、 **[リモート コンピューター:]** の横にある **[検索…]** を選択します。

![[デバッグ] タブ](images/debug-remote-machine-config.png)

Creators Update より前のリモート PC にアプリを展開するには、Visual Studio リモート ツールをターゲット PC にダウンロードしてインストールする必要もあります。 詳しい手順については、「[リモート PC の手順](#remote-pc-instructions)」をご覧ください。  ただし、Creators Update の PC ではリモート展開もサポートされます。  

### <a name="c-and-javascript"></a>C++ および JavaScript

C++ または JavaScript UWP アプリのリモート コンピューター ターゲットを指定するには:

1. **[ソリューション エクスプローラー]** で、プロジェクトを右クリックし、 **[プロパティ]** をクリックします。
2. **[デバッグ]** 設定に移動し、 **[起動するデバッガー]** の下で **[リモート コンピューター]** を選択します。
3. **[コンピューター名]** を入力 (または **[検索…]** をクリックして検出) し、 **[認証の種類]** プロパティを設定します。

![デバッグ プロパティ ページ](images/debug-property-pages.png)

コンピューターを指定した後で、デバッグ ターゲットのドロップダウンで **[リモート コンピューター]** を選択し、その指定コンピューターに戻ることができます。 一度に選ぶことができるリモート コンピューターは 1 つだけです。

### <a name="remote-pc-instructions"></a>リモート PC の手順

> [!NOTE]
> これらの手順は、以前のバージョンの Windows 10 でのみ必要です。  Creators Update の PC は、Xbox と同じように扱うことができます。  つまり、PC の開発者モード メニューでデバイスの検出を有効にし、ユニバーサル認証を使って PIN でペアリングして、PC に接続します。

Creators Update より前のリモート PC に展開するには、ターゲット PC に Visual Studio リモート ツールがインストールされている必要があります。 また、リモート PC がアプリの **[ターゲット プラットフォームの最小バージョン]** プロパティ以上の Windows バージョンを実行している必要もあります。 リモート ツールをインストールしたら、ターゲット PC でリモート デバッガーを起動する必要があります。

これを行うには、 **[スタート]** メニューで **[リモート デバッガー]** を探して開き、プロンプトが表示されたらデバッガーがファイアウォール設定を構成できるようにします。 既定では、デバッガーは Windows 認証を使用して起動します。 両方の PC でサインイン ユーザーが同じでない場合、これにはユーザー資格情報が必要になります。

**[認証なし]** に変更するには、 **[リモート デバッガー]** で **[ツール]**  -&gt; **[オプション]** の順にクリックし、 **[認証なし]** に設定します。 リモート デバッガーを設定したら、ホスト デバイスが[開発者モード](../get-started/enable-your-device-for-development.md)に設定されていることを確認する必要があります。 その後、開発コンピューターから展開できます。

詳しくは、[Visual Studio ダウンロード センター](https://visualstudio.microsoft.com/downloads/)のページをご覧ください。

## <a name="passing-command-line-debug-arguments"></a>デバッグのコマンド ライン引数を渡す

Visual Studio 2019 では、UWP アプリケーションのデバッグを開始するときに、デバッグのコマンド ライン引数を渡すことができます。 デバッグのコマンド ライン引数には、[**Application**](/uwp/api/windows.ui.xaml.application) クラスの **OnLaunched** メソッドで *args* パラメーターからアクセスすることができます デバッグのコマンド ライン引数を指定するには、プロジェクトのプロパティを開き、 **[デバッグ]** タブに移動します。

> [!NOTE]
> これは、Visual Studio 2017 (Version 15.1) で C#、VB、C++ について利用できます。 JavaScript は、将来のバージョンで利用できます。 デバッグのコマンド ライン引数は、シミュレーターを除くすべての種類の展開で利用できます。

C# と VB の UWP プロジェクトでは、 **[開始オプション]** に **[コマンド ライン引数]** フィールドが表示されます。

![コマンド ライン引数](images/command-line-arguments.png)

C++ と JS の UWP プロジェクトでは、 **[デバッグ プロパティ]** のフィールドとして **[コマンド ライン引数]** が表示されます。

![C++ と JS でのコマンド ライン引数](images/command-line-arguments-cpp.png)

コマンド ライン引数を指定すると、アプリの **OnLaunched** メソッドで引数の値にアクセスすることができます。 [  **LaunchActivatedEventArgs**](/uwp/api/windows.applicationmodel.activation.launchactivatedeventargs) オブジェクト *args* は、値が **[コマンド ライン引数]** フィールドのテキストに設定された **Arguments** プロパティを持ちます。

![C++ と JS でのコマンド ライン引数](images/command-line-arguments-debugging.png)

## <a name="authentication-modes"></a>認証モード

リモート コンピューターへの展開用に 3 つの認証モードがあります。

- **ユニバーサル (暗号化されていないプロトコル)** :リモート デバイスに展開するときは、必ずこの認証モードを使います。 これは現在、IoT デバイス、Xbox デバイス、HoloLens デバイスと、Creators Update 以降を搭載した PC を対象としています。 ユニバーサル (暗号化されていないプロトコル) は、信頼されたネットワークで使う必要があります。 デバッグ接続は、開発マシンとリモート マシンとの間で渡されるデータを傍受して変更できる悪意のあるユーザーに対して脆弱です。
- **Windows**:この認証モードは、Visual Studio リモート ツールを実行中のリモート PC (デスクトップまたはノート PC) に使用することのみを意図しています。 ターゲット コンピューターのサインイン ユーザーの資格情報にアクセスできる場合は、この認証モードを使用します。 これは、リモート展開用の最も安全なチャネルです。
- **None**: この認証モードは、Visual Studio リモート ツールを実行中のリモート PC (デスクトップまたはノート PC) に使用することのみを意図しています。 テスト アカウントがサインインしていて資格情報を入力できない環境にテスト コンピューターがセットアップされている場合は、この認証モードを使用します。 リモート デバッガーの設定が、"認証なし" を受け入れるようになっていることを確認してください。

## <a name="advanced-remote-deployment-options"></a>リモート展開の詳細オプション

Visual Studio 2015 Update 3 と Windows 10 Anniversary Update のリリースでは、特定の Windows 10 デバイス向けの、新しいリモート展開の詳細オプションがあります。 リモート展開の詳細オプションは、プロジェクト プロパティの **[デバッグ]** メニューにあります。

新しいプロパティには、次のものが含まれています。

- 展開の種類
- パッケージの登録パス
- レイアウトの一部でなくなっているものも含め、デバイスのすべてのファイルを保持する

### <a name="requirements"></a>要件

リモート展開の詳細オプションを利用するには、次の要件を満たす必要があります。

- Windows 10 Tools 1.4.1 以降 (Windows 10 Anniversary Update SDK を含む) で Visual Studio 2015 Update 3 またはそれ以降の Visual Studio リリースがインストールされていること。すべての最新の開発およびセキュリティ機能を取得できるように、更新された Visual Studio の最新バージョンの使用をお勧めします。
- Windows 10 Anniversary Update の Xbox リモート デバイスまたは Windows 10 Creators Update の PC をターゲットにする
- ユニバーサル認証モードを使う

### <a name="properties-pages"></a>プロパティ ページ

C# または Visual Basic の UWP アプリでは、[プロパティ] ページは、次のようになります。

![CS または VB プロパティ](images/advanced-remote-deploy-cs.png)

C++ UWP アプリでは、プロパティ ページは次のようになります。

![Cpp プロパティ](images/advanced-remote-deploy-cpp.png)

### <a name="copy-files-to-device"></a>デバイスにファイルをコピーする

**[デバイスにファイルをコピーする]** ファイルをリモート デバイスにネットワークを介して物理的に転送します。 **レイアウト フォルダー パス**にビルドされたパッケージ レイアウトをコピーして登録します。 Visual Studio は、Visual Studio プロジェクト内のファイルとの同期してデバイスにコピーされるファイルを保持します。ただし、 **[レイアウトの一部でなくなっているものも含め、デバイスのすべてのファイルを保持する]** のオプションがあります。 このオプションを選択すると、リモート デバイスに以前にコピーされたが、プロジェクトの一部ではなくなったファイルも、リモート デバイス上で維持されます。

**[デバイスにファイルをコピーする]** で指定する**パッケージ登録パス**は、コピー先リモート デバイスの物理的な場所です。 このパスは、任意の相対パスとして指定することができます。 ファイルが展開される場所は、開発ファイルのルートからの相対的な場所となり、ターゲット デバイスによって異なります。 複数の開発者が同じデバイスを共有し、いくつかの異なるビルドのパッケージに作業を行っている場合に、このパスを指定すると便利です。

> [!NOTE]
> **[デバイスにファイルをコピーする]** は現在、Windows 10 Anniversary Update を搭載した Xbox と、Windows 10 Creators Update を搭載した PC でサポートされています。

リモート デバイスでは、レイアウトは次の既定の場所にコピーされます。`\\MY-DEVKIT\DevelopmentFiles\PACKAGE-REGISTRATION-PATH`

### <a name="register-layout-from-network"></a>ネットワークからレイアウトを登録する

ネットワークからレイアウトを登録する場合には、パッケージ レイアウトをネットワーク共有にビルドでき、ネットワークから直接レイアウトをリモート デバイスに登録できます。 これには、リモート デバイスからアクセス可能なレイアウト フォルダー パス (ネットワーク共有) を指定する必要があります。 **[レイアウト フォルダー パス]** プロパティは、Visual Studio を実行している PC からの相対パスで、 **[パッケージ登録パス]** プロパティは、同じパスですが、リモート デバイスからの相対パスです。

ネットワークからレイアウトを正常に登録するには、まず **[レイアウト フォルダー パス]** を共有ネットワーク フォルダーにする必要があります。 これを行うには、エクスプローラーでフォルダーを右クリックして、 **[共有] > [特定のユーザー]** を選択し、フォルダーを共有するユーザーを選択します。 ネットワークからレイアウトを登録する場合、共有へのアクセスを持つユーザーとして登録することを確認するため、資格情報を求められます。

これについては、次の例をご覧ください。

- 例 1 (ネットワーク共有としてアクセス可能な、ローカル レイアウト フォルダー):
  - **レイアウト フォルダー パス** = `D:\Layouts\App1`
  - **パッケージの登録パス** = `\\NETWORK-SHARE\Layouts\App1`

- 例 2 (ネットワーク レイアウト フォルダー):
  - **レイアウト フォルダー パス** = `\\NETWORK-SHARE\Layouts\App1`
  - **パッケージの登録パス** = `\\NETWORK-SHARE\Layouts\App1`

最初にネットワークからレイアウトを登録するときに、ターゲット デバイスに資格情報がキャッシュされるため、繰り返しサインインする必要はありません。 キャッシュされた資格情報を削除するには、Windows 10 SDK の [WinAppDeployCmd.exe ツール](https://docs.microsoft.com/windows/uwp/packaging/install-universal-windows-apps-with-the-winappdeploycmd-tool) と **deletecreds**コマンド を使用できます。

ネットワークからレイアウトを登録する場合には、ファイルは物理的にリモート デバイスにコピーされないため、 **[デバイスのすべてのファイルを保持する]** を選択することはできません。

> [!NOTE]
> **[ネットワークからレイアウトを登録する]** は現在、Windows 10 Anniversary Update を搭載した Xbox と、Windows 10 Creators Update を搭載した PC でサポートされています。

リモート デバイスでは、デバイス ファミリに応じて、既定の場所である `Xbox: \\MY-DEVKIT\DevelopmentFiles\XrfsFiles` にレイアウトが登録されます。これは**パッケージ登録パス**へのシンボリック リンクです。PC ではシンボリック リンクは使われず、代わりに**パッケージ登録パス**が直接登録されます。

## <a name="debugging-options"></a>デバッグのオプション

Windows 10 では、[事前起動](../launch-resume/handle-app-prelaunch.md)と呼ばれる手法でアプリを事前に起動してから中断することにより、UWP アプリの起動パフォーマンスが向上します。 多くのアプリはこのモードで動作するために特別に何もする必要はありませんが、一部のアプリでは動作を調整する必要があります。 これらのコード パスの問題をデバッグするために、事前起動モードで Visual Studio からアプリのデバッグを開始できます。

デバッグは、Visual Studio プロジェクト ( **[デバッグ]**  -&gt; **[その他のデバッグ ターゲット]**  -&gt; **[ユニバーサル Windows アプリ事前起動のデバッグ]** )、および既にコンピューターにインストールされているアプリ ( **[デバッグ]**  -&gt; **[その他のデバッグ ターゲット]**  -&gt; **[インストールされているアプリケーション パッケージのデバッグ]** 、 **[事前起動を使用してアプリをアクティブ化]** のチェック ボックスをオンにする) の両方でサポートされます。 詳しくは、「[事前起動 UWP をデバッグする](https://blogs.msdn.com/b/visualstudioalm/archive/2015/11/30/debug-uwp-prelaunch-with-vs2015.aspx)」をご覧ください。

スタートアップ プロジェクトの **[デバッグ]** プロパティ ページで、次の展開オプションを設定できます。

- **ローカル ネットワーク ループバックの許可**

  セキュリティ上の理由で、標準的な方法でインストールされた UWP アプリでは、それがインストールされているデバイスに対してネットワーク呼び出しを実行することは許可されません。 既定では、Visual Studio の展開では、展開されたアプリについてこの規則が除外されます。 この除外により、単一コンピューター上で通信手順をテストできます。 アプリを Microsoft Store に申請する前に、この除外を使用せずにアプリをテストする必要があります。

  ネットワーク ループバックに関する除外をアプリから除去するには:

  - C# および Visual Basic の  **[デバッグ]** プロパティ ページで、 **[ローカル ネットワーク ループバックの許可]** チェック ボックスをオフにします。
  - JavaScript および C++ の **[デバッグ]** プロパティ ページで、 **[ローカル ネットワーク ループバックの許可]** の値を **[いいえ]** に設定します

- **起動はしないが、開始時にコードをデバッグする / アプリケーションを起動**

  アプリ起動時にデバッグ セッションが自動的に開始されるように展開を構成するには:

  - C# および Visual Basic の  **[デバッグ]** プロパティ ページで、 **[起動はしないが、開始時にコードをデバッグする]** チェック ボックスをオンにします。
  - JavaScript および C++ の **[デバッグ]** プロパティ ページで、 **[アプリの起動]** 値を **[はい]** に設定します。

## <a name="symbols"></a>記号

シンボル ファイルには、変数、関数名、エントリ ポイントのアドレスなど、コードをデバッグするときに非常に便利な値が格納されており、例外とコールスタックの実行順序を把握することができます。 ほとんどの種類の Windows のシンボルは、[Microsoft シンボル サーバー](https://msdl.microsoft.com/download/symbols)から利用することも、高速にオフラインで参照できるように [Windows シンボル パッケージのダウンロード サイト](/windows-hardware/drivers/debugger/debugger-download-symbols)からダウンロードすることもできます。

Visual Studio のシンボル オプションを設定するには、 **[ツール] の [オプション]** を選択し、ダイアログ ウィンドウで **[デバッグ]、[シンボル]** の順に移動します。

![[オプション] ダイアログ ボックス](images/gs-debug-uwp-apps-004.png)

[WinDbg](#windbg) を使ってデバッグ セッションでシンボルを読み込むには、**sympath** 変数をシンボル パッケージの場所に設定します。 たとえば、次のコマンドを実行すると、Microsoft シンボル サーバーからシンボルが読み込まれ、C:\Symbols ディレクトリにキャッシュされます。

```cmd
.sympath SRV*C:\Symbols*http://msdl.microsoft.com/download/symbols
.reload
```

区切り文字 `‘;’` を使用して複数のパスを追加したり、`.sympath+` コマンドを使用することもできます。 WinDbg を使用する高度なシンボル操作については、「[パブリック シンボルとプライベート シンボル](/windows-hardware/drivers/debugger/public-and-private-symbols)」をご覧ください。

## <a name="windbg"></a>WinDbg

WinDbg は、[Windows SDK](https://developer.microsoft.com/) に含まれる、Debugging Tools for Windows の一部として出荷される強力なデバッガーです。 Windows SDK のインストールでは、スタンドアロン製品として Debugging Tools for Windows をインストールすることができます。 ネイティブ コードのデバッグには非常に便利ですが、マネージ コードや HTML5 で記述されたアプリについては WinDbg の使用をお勧めできません。

UWP アプリで WinDbg を使用するには、まず PLMDebug を使用して、アプリ パッケージのプロセス ライフタイム管理 (PLM) を無効にする必要があります。これについては [プロセス ライフタイム管理 (PLM) のテスト ツールとデバッグ ツール](testing-debugging-plm.md) で説明されています。

```cmd
plmdebug /enableDebug [PackageFullName] ""C:\Program Files\Debugging Tools for Windows (x64)\WinDbg.exe\" -server npipe:pipe=test"
```

Visual Studio とは対照的に、WinDbg のコア機能の多くは、コマンド ウィンドウにコマンドを入力する必要があります。 入力したコマンドによって、実行状態の表示、ユーザー モードのクラッシュ ダンプの調査、さまざまなモードでのデバッグを行うことができます。

WinDbg で最もよく使用されるコマンドの 1 つが `!analyze -v` であり、次のように、現在の例外に関する詳細な情報を取得するために使用されます。

- FAULTING_IP: 障害発生時の命令ポインター
- EXCEPTION_RECORD: 現在の例外のアドレス、コード、フラグ
- STACK_TEXT: 例外の前のスタック トレース

WinDbg のすべてのコマンドの一覧については、[デバッガー コマンドに関するページ](/windows-hardware/drivers/debugger/debugger-commands)をご覧ください。

## <a name="related-topics"></a>関連トピック

- [プロセス ライフタイム管理 (PLM) のテスト ツールとデバッグ ツール](testing-debugging-plm.md)
- [デバッグ、テスト、パフォーマンス](index.md)